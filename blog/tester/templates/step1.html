{% extends 'base.html' %}

{% block content %}
<h2>Step 2: Consumption Information</h2>
<form method="post">
    {% csrf_token %}
    {{ form.non_field_errors }} 
    <p align="center" id="cigs">Cigarettes: </p>
    <div class="fieldWrapper">
        {{ form.smoking.errors }}
        {{ form.smoking.label_tag }}
        {{ form.smoking }}
    </div>
    <div class="fieldWrapper">
        {{ form.alcohol.errors }}
        {{ form.alcohol.label_tag }}
        {{ form.alcohol }}
    </div>
    <div class="fieldWrapper">
        {{ form.diet.errors }}
        {{ form.diet.label_tag }}
        {{ form.diet }}
    </div>
    <div class="fieldWrapper">
        {{ form.water.errors }}
        {{ form.water.label_tag }}
        {{ form.water.as_hidden }}
    </div>
    <p align="center" id="cups">Cups: </p>
    <div class="glass">
        <div class="water"></div>
    </div>
    <button id="next-button1" type="submit" class="btn btn-primary">Next</button>
</form>
    <style>
.glass {
    width: 200px;
    height: 300px;
    background-color: rgba(200, 200, 200, 0.2);
    border: 3px solid #000;
    position: relative;
    margin: 50px auto;
    clip-path: polygon(10% 0, 90% 0, 80% 100%, 20% 100%);
}

.water {
    background-color: #00f;
    width: 100%;
    height: 50%;
    position: absolute;
    bottom: 0;
    cursor: ns-resize; /* north-south resize cursor */
}

    </style>
    <script type="text/javascript">
    $(document).ready(function() {

    let cigs = document.getElementById('cigs');


    let isDragging = false;
    let startY;
    let startHeight;
    let cups = document.getElementById('cups');

    cups.innerHTML = `Cups: ${getWaterHeight().toPrecision(2)}`;
    $(".water").on("mousedown", function(e) {
        isDragging = true;
        startY = e.pageY;
        startHeight = $(this).height();
    });

    $(document).on("mousemove", function(e) {
        if (isDragging) {
            let deltaY = startY - e.pageY;
            let newHeight = startHeight + deltaY;
            
            // Ensure the water height doesn't go out of the glass boundaries
            newHeight = Math.min($(".glass").height(), Math.max(1, newHeight));
            cups.innerHTML = `Cups: ${getWaterHeight().toPrecision(2)}`;
            $(".water").height(newHeight);
        }
    }).on("mouseup", function() {
        isDragging = false;
    });

    // To access the water height from JavaScript
    function getWaterHeight() {
        var range = $(".glass").height()
        return $(".water").height()/range*50;
    }

    const next_button = document.getElementById('next-button1');
    const hiddenInput = document.getElementById('id_water');
    
    next_button.addEventListener('click', function() {
        console.log("hell", getWaterHeight());
        hiddenInput.value = getWaterHeight().toPrecision(2);
    });

});

    </script>

</form>

{% endblock %}
